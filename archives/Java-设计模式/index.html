<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,ZE,Galileo,wiki" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Kepler" />
    <link rel="alternate" type="application/rss+xml" title="ze &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="ze &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/kepler-426969802d.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/591f9f7764a8fd2466b8ba7b37e37a9e.json"
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            if(/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)){
                document.body.classList.add('safari')
            }else{
                document.body.classList.remove('safari')
            }
        });
    </script>
    
<title>Java-设计模式 - ze</title>
<meta name="author" content="LifeAlsoIsGG" />
<meta name="description" content="Java设计模式" />
<meta property="og:title" content="Java-设计模式 - ze" />
<meta property="og:description" content="Java设计模式" />
<meta property="og:site_name" content="ze" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/Java-设计模式/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2020-08-09T23:57:52-00.00" />
<meta name="twitter:title" content="Java-设计模式 - ze" />
<meta name="twitter:description" content="Java设计模式" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />
<link rel="icon" href="https://cdn.jsdelivr.net/gh/lifealsoisgg/Wiki@gh-pages/avatar.png" type="images/x-ico" />

    </head>
    
    <body class="content">
        <header>
            <div class="container">
                <section>
                    <a href="/"><img src="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/avatar.png">ze</a>
                </section>
                <section>
                    <nav>
                        <ul>
                            
                                <li><a href="https://blog.ze.online" target="_blank">Blog</a></li>
                            
                                <li><a href="https://photos.ze.online" target="_blank">Photos</a></li>
                            
                                <li><a href="https://github.com/ouzejin" target="_blank">GitHub</a></li>
                            
                                <li><a href="https://twitter.com/ouzejin" target="_blank">Twitter</a></li>
                            
                        </ul>
                    </nav>
                </section>
    
                <section>
                    <a hidden class="toggle-toc" target="_self" href="javascript:void(0)" onclick="$(body).toggleClass('toc-open')"><i class="fa fa-align-right"></i></a>
                    <a hidden class="toggle-navbar" target="_self" href="javascript:void(0)" onclick="$(body).toggleClass('navbar-open')"><i class="fa fa-indent"></i></a>
                    <button class="search-form-input"><i class="fa fa-search"></i></button>
                </section>
            </div>
        </header>

        <main>
            <div id="pjax-container" class="container">
                <aside id="navbar" class="no-scrollbar">
                    
                    <section class="sidebar-nav">
                        
                            <div class="None" ><span><a href="/">Home</a></span></div>
                        
                            <div class="None" ><span><a href="/archives/">Archives</a></span></div>
                        
                            <div class="None" ><span><a href="/About/">About</a></span></div>
                        
                            <div class="None" ><span><a href="/My Project/">My Project</a></span></div>
                        
                    </section>
                    
                    <section>
                        
    <div class=" "><span><a href="/category/数据库/">数据库</a><button class="toggle_sidebar fa"></button></span><ul><div class=" "><span><a href="/category/Redis/">Redis</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Redis实现高并发秒杀系统/">Redis实现高并发秒杀系统</a></li><li class=""><a href="/archives/Redis部署与基本使用/">Redis部署与基本使用</a></li><li class=""><a href="/archives/Redis实现单点登录/">Redis实现单点登录</a></li><li class=""><a href="/archives/Redis理论学习笔记/">Redis理论学习笔记</a></li></ul></div><li class=""><a href="/archives/SQL学习笔记/">SQL学习笔记</a></li><li class=""><a href="/archives/Mysql理论学习笔记/">Mysql理论学习笔记</a></li><div class=" "><span><a href="/category/Hadoop/">Hadoop</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Hadoop伪分布式配置/">Hadoop伪分布式配置</a></li></ul></div></ul></div><div class="open "><span><a href="/category/Java/">Java</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Java-时间处理/">Java-时间处理</a></li><li class=""><a href="/archives/Java-反射/">Java-反射</a></li><li class=""><a href="/archives/Java-JDK8新特性/">Java-JDK8新特性</a></li><li class=""><a href="/archives/Java-IO/">Java-IO</a></li><li class=""><a href="/archives/Java-JVM/">Java-JVM</a></li><li class=""><a href="/archives/Java-集合容器/">Java-集合容器</a></li><li class=""><a href="/archives/Java-多线程并发/">Java-多线程并发</a></li><li class="current"><a href="/archives/Java-设计模式/">Java-设计模式</a></li><li class=""><a href="/archives/Java-方法汇总/">Java-方法汇总</a></li><li class=""><a href="/archives/Java-基础面试题/">Java-基础面试题</a></li><li class=""><a href="/archives/Java-基础知识笔记/">Java-基础知识笔记</a></li></ul></div><div class=" "><span><a href="/category/面试/">面试</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/腾讯云学习笔记/">腾讯云学习笔记</a></li><li class=""><a href="/archives/面试题整理/">面试题整理</a></li><li class=""><a href="/archives/腾讯移动客户端面经/">腾讯移动客户端面经</a></li><li class=""><a href="/archives/计算机其它面试题/">计算机其它面试题</a></li><li class=""><a href="/archives/Mysql&Redis数据库面试题/">Mysql&Redis数据库面试题</a></li><li class=""><a href="/archives/Spring框架面试题/">Spring框架面试题</a></li><li class=""><a href="/archives/字节跳动面试/">字节跳动面试</a></li><li class=""><a href="/archives/后端面试题/">后端面试题</a></li></ul></div><div class=" "><span><a href="/category/Spring/">Spring</a><button class="toggle_sidebar fa"></button></span><ul><div class=" "><span><a href="/category/SpringBoot/">SpringBoot</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Swagger使用/">Swagger使用</a></li><li class=""><a href="/archives/Lombok使用/">Lombok使用</a></li><li class=""><a href="/archives/Maven中依赖的scope总结/">Maven中依赖的scope总结</a></li><li class=""><a href="/archives/Devtools对Springboot热部署/">Devtools对Springboot热部署</a></li><li class=""><a href="/archives/IDEA配置Run Dashboard/">IDEA配置Run Dashboard</a></li><li class=""><a href="/archives/IDEA初始化SpringBoot项目+逆向工程+配置/">IDEA初始化SpringBoot项目+逆向工程+配置</a></li><li class=""><a href="/archives/EasyExcel导入导出Excel/">EasyExcel导入导出Excel</a></li><li class=""><a href="/archives/服务器上部署SpringBoot/">服务器上部署SpringBoot</a></li></ul></div><div class=" "><span><a href="/category/Mybatis/">Mybatis</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Mybatis学习笔记/">Mybatis学习笔记</a></li><li class=""><a href="/archives/Mybatis逆向工程&Example类使用/">Mybatis逆向工程&Example类使用</a></li></ul></div><li class=""><a href="/archives/HttpServletrequest与HttpServletResponse/">HttpServletrequest与HttpServletResponse</a></li><li class=""><a href="/archives/SpringMVC基础&面试/">SpringMVC基础&面试</a></li><li class=""><a href="/archives/SpringMVC注解/">SpringMVC注解</a></li><li class=""><a href="/archives/Spring基础&面试/">Spring基础&面试</a></li><div class=" "><span><a href="/category/SpringCloud/">SpringCloud</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/认识SpringCloud/">认识SpringCloud</a></li></ul></div></ul></div><div class=" "><span><a href="/category/前端/">前端</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/JavaScript面试题/">JavaScript面试题</a></li><li class=""><a href="/archives/Promise异步调用/">Promise异步调用</a></li></ul></div><div class=" "><span><a href="/category/数据结构&算法/">数据结构&算法</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/数据结构&算法基础笔记/">数据结构&算法基础笔记</a></li><li class=""><a href="/archives/数据结构&算法题目合集/">数据结构&算法题目合集</a></li></ul></div><div class=" "><span><a href="/category/Linux/">Linux</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Linux常用命令/">Linux常用命令</a></li><li class=""><a href="/archives/xshell connect to Centos7 in VMware/">用xshell连接虚拟机中的Centos7</a></li><div class=" "><span><a href="/category/Docker/">Docker</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/Docker:Install-software/">Docker:Install software</a></li><li class=""><a href="/archives/Docker-deployment/">Docker deployment</a></li></ul></div></ul></div><div class=" "><span><a href="/category/My Project/">My Project</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/MyProject-AttendanceMiniprogram/">实验室出入管理小程序</a></li><li class=""><a href="/archives/ActivitySystem/">Javaweb大学活动管理系统</a></li><li class=""><a href="/archives/MyProject-SupermarketSystem/">Java Swing-超市系统</a></li></ul></div><div class=" "><span><a href="/category/Other/">Other</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/大三下实训期末作业/">大三下实训期末作业</a></li><li class=""><a href="/archives/修改Host以访问Github/">修改Host以访问Github</a></li></ul></div><div class=" "><span><a href="/category/Notes/">Notes</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/软考软件设计师笔记/">软考软件设计师笔记</a></li></ul></div><div class=" "><span><a href="/category/Maverick/">Maverick</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/archives/typography/">Hello World!</a></li></ul></div>

                    </section>
                    <section hidden class="sidebar-external-link">
                        
                            <div class="external"><span><a href="https://blog.ze.online">Blog</a><button class="go-external"><i class="fa fa-external-link"></i></button></span></div>
                        
                            <div class="external"><span><a href="https://photos.ze.online">Photos</a><button class="go-external"><i class="fa fa-external-link"></i></button></span></div>
                        
                            <div class="external"><span><a href="https://github.com/ouzejin">GitHub</a><button class="go-external"><i class="fa fa-external-link"></i></button></span></div>
                        
                            <div class="external"><span><a href="https://twitter.com/ouzejin">Twitter</a><button class="go-external"><i class="fa fa-external-link"></i></button></span></div>
                        
                    </section>
                    <section class="maverick">
                        <div><span style="border: 1px solid #d4dadf;"><a href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Kepler</a></span></div>
                    </section>
                </aside>
                <div id="content-wrapper">
                    <div id="content">
    <section>
        <h1 class="post-title">Java-设计模式</h1>
        <p class="post-meta">
            <time>August 09 2020</time>
            <span class="tags">
                
                <span>
                    <a href="/tag/Java/">#Java</a>
                </span>
                
                <span>
                    <a href="/tag/Java设计模式/">#Java设计模式</a>
                </span>
                
            </span>
        </p>
        <article class="yue"><p>Java设计模式</p>
<h1>1. 总览</h1>
<p>参考</p>
<blockquote><ul>
<li><a href="https://www.runoob.com/design-pattern/design-pattern-intro.html">https://www.runoob.com/design-pattern/design-pattern-intro.html</a></li>
</ul>
</blockquote>
<p>根据设计模式的参考书 <strong>Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 - 可复用的面向对象软件元素）</strong> 中所提到的，总共有 23 种设计模式。这些模式可以分为三大类：创建型模式（Creational Patterns）、结构型模式（Structural Patterns）、行为型模式（Behavioral Patterns）。当然，我们还会讨论另一类设计模式：J2EE 设计模式。</p>
<ul>
<li><p><strong>创建型模式</strong></p>
<blockquote><p>这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。</p>
</blockquote>
</li>
</ul>
<ul>
<li><p><strong>结构型模式</strong></p>
<blockquote><p>这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。</p>
</blockquote>
</li>
</ul>
<ul>
<li><p><strong>行为型模式</strong></p>
<blockquote><p>这些设计模式特别关注对象之间的通信。</p>
</blockquote>
</li>
</ul>
<ul>
<li><p><strong>J2EE 模式</strong></p>
<blockquote><p>这些设计模式特别关注表示层。这些模式是由 Sun Java Center 鉴定的。</p>
</blockquote>
</li>
</ul>
<h2>1.1 创建型模式</h2>
<p>这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。</p>
<ul>
<li>工厂模式（Factory Pattern）</li>
<li>抽象工厂模式（Abstract Factory Pattern）</li>
<li>单例模式（Singleton Pattern）</li>
<li>建造者模式（Builder Pattern）</li>
<li>原型模式（Prototype Pattern）</li>
</ul>
<h2>1.2 结构型模式</h2>
<p>这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。</p>
<ul>
<li>适配器模式（Adapter Pattern）</li>
<li>桥接模式（Bridge Pattern）</li>
<li>过滤器模式（Filter、Criteria Pattern）</li>
<li>组合模式（Composite Pattern）</li>
<li>装饰器模式（Decorator Pattern）</li>
<li>外观模式（Facade Pattern）</li>
<li>享元模式（Flyweight Pattern）</li>
<li>代理模式（Proxy Pattern）</li>
</ul>
<h2>1.3 行为型模式</h2>
<p>这些设计模式特别关注对象之间的通信。</p>
<ul>
<li>责任链模式（Chain of Responsibility Pattern）</li>
<li>命令模式（Command Pattern）</li>
<li>解释器模式（Interpreter Pattern）</li>
<li>迭代器模式（Iterator Pattern）</li>
<li>中介者模式（Mediator Pattern）</li>
<li>备忘录模式（Memento Pattern）</li>
<li>观察者模式（Observer Pattern）</li>
<li>状态模式（State Pattern）</li>
<li>空对象模式（Null Object Pattern）</li>
<li>策略模式（Strategy Pattern）</li>
<li>模板模式（Template Pattern）</li>
<li>访问者模式（Visitor Pattern）</li>
</ul>
<h2>1.4 J2EE 模式</h2>
<p>这些设计模式特别关注表示层。这些模式是由 Sun Java Center 鉴定的。</p>
<ul>
<li>MVC 模式（MVC Pattern）</li>
<li>业务代表模式（Business Delegate Pattern）</li>
<li>组合实体模式（Composite Entity Pattern）</li>
<li>数据访问对象模式（Data Access Object Pattern）</li>
<li>前端控制器模式（Front Controller Pattern）</li>
<li>拦截过滤器模式（Intercepting Filter Pattern）</li>
<li>服务定位器模式（Service Locator Pattern）</li>
<li>传输对象模式（Transfer Object Pattern）</li>
</ul>
<h1>2. 单例模式</h1>
<p><code>创建型模式</code></p>
<p>参考</p>
<blockquote><ul>
<li><a href="https://www.runoob.com/design-pattern/singleton-pattern.html">https://www.runoob.com/design-pattern/singleton-pattern.html</a></li>
</ul>
</blockquote>
<p>单例模式（Singleton Pattern）是 Java 中最简单的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>这种模式涉及到一个单一的类，该类负责创建自己的对象，同时确保只有单个对象被创建。这个类提供了一种访问其唯一的对象的方式，可以直接访问，不需要实例化该类的对象。</p>
<p>单例模式保证了系统内存中只存在一个对象，节省了系统资源,对于一些需要<code>频繁创建销毁</code>的对象,使用单例模式可以提高系统性能。当想实例化一个单例类的时候,必须要记住使用相应的获取对象的方法,而不是使用new</p>
<p>单例模式使用的场景:</p>
<blockquote><p>需要频繁的进行创建和销毁的对象，创建对象时耗时过多或耗费资源过多(即:重量级对象),但又经常用到的对象、工具类对象、频繁访问数据库或文件的对象(比如数据源、 session工厂等)</p>
</blockquote>
<ul>
<li>1、单例类只能有一个实例。</li>
<li>2、单例类必须自己创建自己的唯一实例。</li>
<li>3、单例类必须给所有其他对象提供这一实例。</li>
</ul>
<h2>2.1 步骤</h2>
<h3>步骤 1：创建一个 <code>Singleton</code> 类</h3>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingleObject</span> <span class="p">{</span>

   <span class="c1">//创建 SingleObject 的一个对象</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="n">SingleObject</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SingleObject</span><span class="p">();</span>

   <span class="c1">//让构造函数为 private，这样该类就不会被实例化</span>
   <span class="kd">private</span> <span class="nf">SingleObject</span><span class="p">(){}</span>

   <span class="c1">//获取唯一可用的对象</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="n">SingleObject</span> <span class="nf">getInstance</span><span class="p">(){</span>
      <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showMessage</span><span class="p">(){</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h3>步骤 2：从 <code>singleton</code> 类获取唯一的对象</h3>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonPatternDemo</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">//不合法的构造函数</span>
      <span class="c1">//编译时错误：构造函数 SingleObject() 是不可见的</span>
      <span class="c1">//SingleObject object = new SingleObject();</span>

      <span class="c1">//获取唯一可用的对象</span>
      <span class="n">SingleObject</span> <span class="n">object</span> <span class="o">=</span> <span class="n">SingleObject</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

      <span class="c1">//显示消息</span>
      <span class="n">object</span><span class="p">.</span><span class="na">showMessage</span><span class="p">();</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>2.2 懒汉式，线程不安全</h2>
<table>
<thead><tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否 Lazy 初始化</td>
<td>是</td>
</tr>
<tr>
<td>是否多线程安全</td>
<td>否</td>
</tr>
<tr>
<td>实现难度</td>
<td>易</td>
</tr>
</tbody>
</table>
<p>描述</p>
<blockquote><p>这种方式是最基本的实现方式，这种实现最大的问题就是不支持多线程。因为没有加锁 <code>synchronized</code>，所以严格意义上它并不算单例模式。这种方式 lazy loading 很明显，不要求线程安全，在多线程不能正常工作。<strong>实际不推荐使用</strong></p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="p">{</span>  
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="n">instance</span><span class="p">;</span>  
    <span class="kd">private</span> <span class="nf">Singleton</span> <span class="p">(){}</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>  
    <span class="k">if</span> <span class="p">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>  
        <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton</span><span class="p">();</span>  
    <span class="p">}</span>  
    <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>  
    <span class="p">}</span>  
<span class="p">}</span>
</pre></div>
<h2>2.3 懒汉式，线程安全</h2>
<table>
<thead><tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否 Lazy 初始化</td>
<td>是</td>
</tr>
<tr>
<td>是否多线程安全</td>
<td>是</td>
</tr>
<tr>
<td>实现难度</td>
<td>易</td>
</tr>
</tbody>
</table>
<p>描述</p>
<blockquote><p>这种方式具备很好的 lazy loading，能够在多线程中很好的工作，但是，效率很低，只有第一次创建的时候需要同步，99% 情况下不需要同步。优点：第一次调用才初始化，避免内存浪费。缺点：必须加锁 <code>synchronized</code> 才能保证单例，但加锁会影响效率。getInstance() 的性能对应用程序不是很关键（该方法使用不太频繁）。<strong>实际不推荐使用</strong></p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="p">{</span>  
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="n">instance</span><span class="p">;</span>  
    <span class="kd">private</span> <span class="nf">Singleton</span> <span class="p">(){}</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">Singleton</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>  
    <span class="k">if</span> <span class="p">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>  
        <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton</span><span class="p">();</span>  
    <span class="p">}</span>  
    <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>  
    <span class="p">}</span>  
<span class="p">}</span>
</pre></div>
<h2>2.3 饿汉式</h2>
<table>
<thead><tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否 Lazy 初始化</td>
<td>否</td>
</tr>
<tr>
<td>是否多线程安全</td>
<td>是</td>
</tr>
<tr>
<td>实现难度</td>
<td>易</td>
</tr>
</tbody>
</table>
<p>描述</p>
<blockquote><p>这种方式比较常用，但容易产生垃圾对象。它基于 classloader 机制避免了多线程的同步问题，不过，instance 在类装载时就实例化，虽然导致类装载的原因有很多种，在单例模式中大多数都是调用 getInstance 方法， 但是也不能确定有其他的方式（或者其他的静态方法）导致类装载，这时候初始化 instance 显然没有达到 lazy loading 的效果。</p>
<p>优点：没有加锁，执行效率会提高。</p>
<p>缺点：类加载时就初始化，浪费内存。</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton</span><span class="p">();</span>  
    <span class="kd">private</span> <span class="nf">Singleton</span> <span class="p">(){}</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>  
    <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>  
    <span class="p">}</span>  
<span class="p">}</span>
</pre></div>
<p>静态代码块写法</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton_Hungry</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Singleton_Hungry</span> <span class="n">instance</span><span class="p">;</span>
    <span class="kd">static</span> <span class="p">{</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton_Hungry</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="nf">Singleton_Hungry</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Singleton_Hungry</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>2.4 双重校验锁懒汉式（DCL，即 double-checked locking）</h2>
<table>
<thead><tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否 Lazy 初始化</td>
<td>是</td>
</tr>
<tr>
<td>是否多线程安全</td>
<td>是</td>
</tr>
<tr>
<td>实现难度</td>
<td>较复杂</td>
</tr>
</tbody>
</table>
<p>描述</p>
<blockquote><p>JDK1.5 起。这种方式采用双锁机制，安全且在多线程情况下能保持高性能。<code>getInstance()</code> 的性能对应用程序很关键。推荐使用</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="p">{</span>  
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="n">singleton</span><span class="p">;</span>  
    <span class="kd">private</span> <span class="nf">Singleton</span> <span class="p">(){}</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="nf">getSingleton</span><span class="p">()</span> <span class="p">{</span>  
    <span class="k">if</span> <span class="p">(</span><span class="n">singleton</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>  
        <span class="kd">synchronized</span> <span class="p">(</span><span class="n">Singleton</span><span class="p">.</span><span class="na">class</span><span class="p">)</span> <span class="p">{</span>  
        <span class="k">if</span> <span class="p">(</span><span class="n">singleton</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>  
            <span class="n">singleton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton</span><span class="p">();</span>  
        <span class="p">}</span>  
        <span class="p">}</span>  
    <span class="p">}</span>  
    <span class="k">return</span> <span class="n">singleton</span><span class="p">;</span>  
    <span class="p">}</span>  
<span class="p">}</span>
</pre></div>
<p>另外，需要注意 uniqueInstance 采⽤ <code>volatile</code> 关键字修饰也是很有必要。<code>volatile</code>作用是防止在new实例的时候,还没初始化完,有其他线程进来,实例此时已经不为空.多线程拿到的实例数据就不一致,加了该关键字后,先初始化完成后在赋值给实例。 uniqueInstance = new Singleton(); 这段代码其实是分为三步执⾏：</p>
<ol>
<li>为 uniqueInstance 分配内存空间 </li>
<li>初始化 uniqueInstance </li>
<li>将 uniqueInstance 指向分配的内存地址 </li>
</ol>
<p>但是由于 JVM 具有指令重排的特性，执⾏顺序有可能变成 1&gt;3&gt;2。指令重排在单线程环境下不会出 现问题，但是在多线程环境下会导致⼀个线程获得还没有初始化的实例。例如，线程 T1 执⾏了 1 和 3，此时 T2 调⽤ getUniqueInstance() 后发现 uniqueInstance 不为空，因此返回 uniqueInstance，但此时 uniqueInstance 还未被初始化。 使⽤ volatile 可以禁⽌ JVM 的指令重排，保证在多线程环境下也能正常运⾏。</p>
<h2>2.5 静态内部类</h2>
<p>参考</p>
<blockquote><ul>
<li><a href="https://blog.csdn.net/mnb65482/article/details/80458571">https://blog.csdn.net/mnb65482/article/details/80458571</a></li>
</ul>
</blockquote>
<table>
<thead><tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否 Lazy 初始化</td>
<td>是</td>
</tr>
<tr>
<td>是否多线程安全</td>
<td>是</td>
</tr>
<tr>
<td>实现难度</td>
<td>较复杂</td>
</tr>
</tbody>
</table>
<p>描述</p>
<blockquote><p>静态内部类的优点是：上升为顶级类，外部类加载时并不需要立即加载内部类，内部类不被加载则不去初始化<code>INSTANCE</code>，故而不占内存。即当<code>SingleTon</code>第一次被加载时，并不需要去加载<code>SingletonInstance</code>，只有当<code>getInstance()</code>方法第一次被调用时，才会去初始化<code>INSTANCE</code>,第一次调用<code>getInstance()</code>方法会导致虚拟机加载<code>SingleTonHoler</code>类，这种方法不仅能确保线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。</p>
<p>这种方式采用了类装载的机制来保证初始化实例时只有一个线程。静态内部类方式在 <code>Singleton</code>类被装载时并不会立即<code>实例化</code>,而是在需要实例化时,调用 <code>getInstance</code>方法,才会装载 <code>Singletoninstance</code>类,从而完成 <code>Singleton</code>的实例化。类的静态属性只会在第一次加载类的时候初始化,所以在这里,帮助我们保证了线程的安全性,在类进行初始化时,别的线程是无法进入的。优点:避免了线程不安全,利用静态内部类特点实现延迟加载,效率高。结论:推荐使用</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton</span><span class="p">{</span>
    <span class="kd">private</span> <span class="nf">Singleton</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingletonInstance</span><span class="p">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Singleton</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton</span><span class="p">();</span>
    <span class="p">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">SingletonInstance</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<blockquote><p>我们再回头看下getInstance()方法，调用的是SingleTonHoler.INSTANCE，取的是SingleTonHoler里的INSTANCE对象，跟上面那个DCL方法不同的是，getInstance()方法并没有多次去new对象，故不管多少个线程去调用getInstance()方法，取的都是同一个INSTANCE对象，而不用去重新创建。当getInstance()方法被调用时，SingleTonHoler才在SingleTon的运行时常量池里，把符号引用替换为直接引用，这时静态对象INSTANCE也真正被创建，然后再被getInstance()方法返回出去，这点同饿汉模式。那么INSTANCE在创建过程中又是如何保证线程安全的呢？在《深入理解JAVA虚拟机》中，有这么一句话:</p>
<p>虚拟机会保证一个类的&lt;\clinit&gt;()方法在多线程环境中被正确地加锁、同步，如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的&lt;\clinit&gt;()方法，其他线程都需要阻塞等待，直到活动线程执行&lt;\clinit&gt;()方法完毕。如果在一个类的&lt;\clinit&gt;()方法中有耗时很长的操作，就可能造成多个进程阻塞(需要注意的是，其他线程虽然会被阻塞，但如果执行&lt;\clinit&gt;()方法后，其他线程唤醒之后不会再次进入&lt;\clinit&gt;()方法。同一个加载器下，一个类型只会初始化一次。)，在实际应用中，这种阻塞往往是很隐蔽的。</p>
<p>故而，可以看出INSTANCE在创建过程中是线程安全的，所以说静态内部类形式的单例可保证线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。</p>
<p>那么，是不是可以说静态内部类单例就是最完美的单例模式了呢？其实不然，静态内部类也有着一个致命的缺点，就是传参的问题，由于是静态内部类的形式去创建单例的，故外部无法传递参数进去，例如Context这种参数，所以，我们创建单例时，可以在静态内部类与DCL模式里自己斟酌。</p>
</blockquote>
<h2>2.6 枚举式</h2>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">SingleTon</span><span class="p">{</span>
  <span class="n">INSTANCE</span><span class="p">;</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="p">(){</span>
        <span class="c1">//TODO</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="n">SingleTon</span><span class="p">.</span><span class="na">INSTANCE</span>
</pre></div>
<p>描述</p>
<blockquote><p>枚举在java中与普通类一样，都能拥有字段与方法，而且枚举实例创建是线程安全的，在任何情况下，它都是一个单例。还能防止反序列化重新创建新的对象</p>
</blockquote>
<h1>2. 工厂/抽象工厂模式</h1>
<p><code>创建型模式</code></p>
<p>工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p>
<p>参考</p>
<blockquote><ul>
<li><a href="https://www.runoob.com/design-pattern/factory-pattern.html">https://www.runoob.com/design-pattern/factory-pattern.html</a></li>
<li>反射在工厂模式的使用：<a href="https://www.cnblogs.com/ssrs-wanghao/articles/8993338.html">https://www.cnblogs.com/ssrs-wanghao/articles/8993338.html</a></li>
</ul>
</blockquote>
<p>用反射的工厂</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Shape</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">getShape</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">clz</span><span class="p">){</span>
        <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">clz</span><span class="p">.</span><span class="na">getName</span><span class="p">()).</span><span class="na">newInstance</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">;</span>

    <span class="p">}</span>
</pre></div>
</article>
    </section>

    
    <section id="content-pager">
        
            <div class="next">
                <a class="card" href="/archives/Linux常用命令/">
                    <time>August 14 2020</time>
                    <span>Linux常用命令</span>
                </a>
            </div>
        
        
            <div class="prev">
                <a class="card" href="/archives/Java-方法汇总/">
                    <time>August 09 2020</time>
                    <span>Java-方法汇总</span>
                </a>
            </div>
        
    </section>
    

    
        <section id="comments">
            <div id="vcomments"></div>
        </section>
        <script>
            window.ValineOpt = {"enable": true, "el": "#vcomments", "appId": "0j0KcckWXNcj4LM9RWVh1nKN-gzGzoHsz", "appKey": "TGMR5Eo0w2lsuE1wyO7p5cyv", "visitor": true, "recordIP": true, "placeholder": "\u7565\u61c2"};
            window.ValineOpt.path = window.location.pathname;
        </script>
    

    <script>
        document.body.classList.add('content');
        document.body.classList.remove('archive');
    </script>
</div>
                    <footer>
                        <span>Copyright © 2020 ze</span>
                        
    <span class="leancloud_visitors"
            id="/archives/Java-设计模式/" 
            data-flag-title="Java-设计模式">
            <i class="fa fa-eye"></i> <i style="font-style: normal" class="leancloud-visitors-count"></i> Views
        </span>

                        <span class="addon">
<p><a href="http://www.beian.miit.gov.cn">粤ICP备19126168号</a>
</span>
                    </footer>
                </div>
                
<aside id="toc-container" class="no-scrollbar">
    <span><i class="fa fa-align-right"></i> CONTENTS</span>
    <div id="toc"></div>
</aside>

            </div>
        </main>


        <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/kepler-ef161b04d5.js"></script>
        <script>
            function ExSearchCall(item){
                if (item && item.length) {
                    $('.ins-close').click(); // 关闭搜索框
                    $('input.ins-search-input').val(''); // 清空
                    let url = item.attr('data-url'); // 获取目标页面 URL
                    $.pjax({url: url, 
                        container: '#pjax-container',
                        fragment: '#pjax-container',
                        timeout: 8000, }); // 发起一次 PJAX 请求
                }
            }
        </script>

        <!--Valine-->
        
            <script>
                var initValine = function () {
                    if (typeof window.ValineOpt === 'object' && $(window.ValineOpt.el).length) {
                        new Valine(window.ValineOpt);
                    }
                }
            </script>
            <script async src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
        

        <!--ExSearch-->
        <script src="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
        
        <!--katex-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/katex.min.css">
        <script defer src="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/katex.min.js"></script>
        <script>
        mathOpts = {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "\\[", right: "\\]", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false}
            ]
        };
        </script>
        <script defer src="https://cdn.jsdelivr.net/gh/ouzejin/ze@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

        
    </body>
</html>